@page "/"

@rendermode InteractiveServer
<PageTitle>Songdle - Daily Music Guessing Game</PageTitle>



    <!-- Main Game Area -->
    <main class="game-main">
        <!-- Input Section -->
        <div class="clue-section">
            <div class="clue-container">
            <h2 class="clue-title">Today's Song Hint</h2>
            <div class="clue-text">
                @if (todaysGame != null)
                {
                    <p>@todaysGame.Clue</p>
                }
                else
                {
                    <p>Loading today's song clue...</p>
                }
            </div>
            </div>
        </div>
        <div class="input-section">
            <div class="search-container">
                <div class="search-input-wrapper">
                    <input type="text" class="search-input" placeholder="Type song title..." @bind="guessInput"
                        @oninput="OnInputChanged" disabled="@isCorrect" />
                    <div class="search-icon">🔍</div>
                </div>

                @if (suggestions.Any() && !isCorrect)
                {
                    <div class="suggestions-dropdown">
                        @foreach (var suggestion in suggestions)
                        {
                            <div class="suggestion-item" @onclick="() => SelectSuggestion(suggestion)">
                                <div class="suggestion-content">
                                    <div class="suggestion-title">@suggestion.Title</div>
                                    <div class="suggestion-artist">@suggestion.Artist</div>
                                </div>
                            </div>
                        }
                    </div>
                }

                <button class="guess-button @(isSongSelected && !isCorrect ? "active" : "")" @onclick="SubmitGuess"
                    disabled="@(!isSongSelected || isCorrect)">
                    <span class="button-text">Make Guess</span>
                    <span class="button-icon">🎯</span>
                </button>
            </div>
        </div>

        @if (isCorrect)
        {
            <div class="victory-section">
                <div class="victory-card">
                    <div class="victory-icon">🎉</div>
                    <div class="victory-text">
                        <h2>Congratulations!</h2>

                        <p>You guessed today's song in @guessResults.Count @(guessResults.Count == 1 ? "try" : "tries")!</p>
                    </div>
                </div>
            </div>
        }



        <!-- Results Feed -->
        @if (guessResults.Any())
        {
            <div class="results-section">
                <h3 class="results-title">Your Guesses</h3>

                <div class="guess-feed">
                    @for (int i = 0; i < guessResults.Count; i++)
                    {
                        var result = guessResults[i];
                        var check = answerResults[i];
                        var guessNumber = guessResults.Count - i;
                        var isLatest = i == 0;

                        <div class="guess-row @(isLatest ? "latest-guess" : "")">


                            <div class="guess-card">
                                <!-- Album Cover -->
                                <div class="album-cover">
                                    <img src="@result.ImageUrl" alt="@result.Title cover" onerror="this.style.display='none'" />
                                    <div class="cover-placeholder">🎵</div>
                                </div>

                                <!-- Song Info -->
                                <div class="song-info">
                                    <div class="song-header">
                                        <div class="song-title @GetAccuracyClass(check.TitleCheck)">
                                            @if (check.TitleCheck == 2)
                                            {
                                                var titleWords = SplitTitleIntoWords(result.Title);
                                                @foreach (var item in titleWords.Select((word, idx) => new { word, idx }))
                                                {
                                                    if (check.TitleCheckIndexes.Contains(item.idx))
                                                    {
                                                        <span class="highlight-word">@item.word</span>
                                                    }
                                                    else
                                                    {
                                                        <span>@item.word</span>
                                                    }
                                                    <span class="word-separator">&nbsp;</span>
                                                }
                                            }
                                            else
                                            {
                                                @result.Title
                                            }
                                        </div>
                                        @if (isCorrect && isLatest)
                                        {
                                            <div class="success-badge">
                                                <span class="badge-icon">🎉</span>
                                                <span class="badge-text">Correct!</span>
                                            </div>
                                        }
                                    </div>

                                    <!-- Attributes Grid -->
                                    <div class="attributes-grid">
                                        <div class="attribute @GetBoolClass(check.ArtistCheck)">
                                            <span class="attr-icon">👤</span>
                                            <span class="attr-label">Artist:</span>
                                            <span class="attr-value">@result.Artist</span>
                                        </div>

                                        <div class="attribute @GetBoolClass(check.AlbumCheck)">
                                            <span class="attr-icon">💿</span>
                                            <span class="attr-label">Album:</span>
                                            <span class="attr-value">@result.Album</span>
                                        </div>

                                        <div class="attribute @GetIntClass(check.ReleaseDateCheck)">
                                            <span class="attr-icon">📅</span>
                                            <span class="attr-label">Release:</span>
                                            <span class="attr-value">
                                                @result.ReleaseDate.ToString("dd.MM.yyyy")
                                                @GetIntArrow(check.ReleaseDateCheck)
                                            </span>
                                        </div>

                                        <div class="attribute @GetFeatsClass(check.FeatsCheck)">
                                            <span class="attr-icon">🤝</span>
                                            <span class="attr-label">Feats:</span>
                                            <span class="attr-value">@(result.Feats.Any() ? string.Join(", ", result.Feats) :
                                                                                        "None")</span>
                                    </div>

                                    <div class="attribute @GetIntClass(check.PopularityCheck)">
                                        <span class="attr-icon">🌟</span>
                                        <span class="attr-label">Popularity (0-100):</span>
                                        <span class="attr-value">
                                            @result.Popularity
                                            @GetIntArrow(check.PopularityCheck)
                                        </span>
                                    </div>
                                    <div class="attribute @GetIntClass(check.DurationCheck)">
                                        <span class="attr-icon">🕖</span>
                                        <span class="attr-label">Duration:</span>
                                        <span class="attr-value">
                                            @FormatDuration(result.Duration)
                                            @GetIntArrow(check.DurationCheck)
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
                }

        <!-- Victory Message -->

    </main>

